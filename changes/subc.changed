Complete refactor of subcommand handling for faster handling and development
